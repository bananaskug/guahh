<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guahh Lists</title>
    <style>
        /* --- Color Variable & General Setup --- */
        :root {
            --primary-color: #6264a7;
            --primary-color-hover: #4f518a;
            
            --bg-deep: #1e1e1e;       /* Deepest background */
            --bg-main: #252526;       /* Main content area */
            --bg-sidebar: #333333;    /* Sidebar background */
            --bg-hover: #3f3f40;      /* Hover states */
            --bg-active: #4a4a4f;     /* Active list item */

            --text-primary: #cccccc;  /* Main text */
            --text-secondary: #999999;/* Dimmer text */
            
            --border-color: #444444;  /* Borders */
        }

        * {
            box-sizing: border-box;
            border-radius: 0 !important;
        }

        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
            font-family: "Segoe UI", "Calibri", "Helvetica Neue", sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-primary);
        }

        /* --- Main Layout --- */
        #layout-container { display: flex; height: 100vh; }

        #sidebar {
            flex: 0 0 280px;
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        #main-content {
            flex-grow: 1;
            background-color: var(--bg-main);
            padding: 30px 40px;
            overflow-y: auto;
        }
        
        /* --- Sidebar Specifics --- */
        #sidebar h2 { font-size: 1.2em; color: var(--text-primary); margin: 0 0 10px 0; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        #new-list-form-container { margin-bottom: 20px; display: flex; }
        #sidebar-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
        #sidebar-list li { padding: 12px 10px; cursor: pointer; font-size: 16px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); word-break: break-all; position: relative; }
        #sidebar-list li:hover { background-color: var(--bg-hover); }
        #sidebar-list li.active { background-color: var(--bg-active); font-weight: 600; color: #fff; }
        #sidebar-list li.active::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background-color: var(--primary-color); }

        /* --- Main Content Area Styles --- */
        #main-content h2 { font-size: 2em; color: var(--primary-color); font-weight: 600; margin: 0; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .placeholder-text { text-align: center; color: var(--text-secondary); font-size: 1.2em; padding: 100px 20px; }
        ul.items-list { list-style: none; padding: 0; margin: 0 0 20px 0; }
        .list-item { display: flex; align-items: center; padding: 12px 5px; border-bottom: 1px solid var(--border-color); transition: background-color 0.2s; }
        .list-item:hover { background-color: var(--bg-hover); }
        .list-item.completed { opacity: 0.5; }
        .list-item.completed span { text-decoration: line-through; }
        .list-item input[type="checkbox"] { margin-right: 15px; width: 20px; height: 20px; flex-shrink: 0; cursor: pointer; accent-color: var(--primary-color); }
        .list-item span { flex-grow: 1; word-break: break-all; }
        .list-item .delete-item-btn { visibility: hidden; opacity: 0; }
        .list-item:hover .delete-item-btn { visibility: visible; opacity: 1; }

        /* --- Shared Form & Button Styles --- */
        .form-group { display: flex; }
        input[type="text"] { flex-grow: 1; padding: 10px; font-size: 14px; border: 1px solid #555; background-color: var(--bg-deep); color: var(--text-primary); }
        input[type="text"]:focus { outline: 2px solid var(--primary-color); border-color: var(--primary-color); }
        button { padding: 10px 15px; font-size: 14px; border: 1px solid #555; background-color: var(--bg-hover); color: var(--text-primary); cursor: pointer; }
        button:hover { border-color: #666; background-color: var(--bg-active); }
        button.primary { background-color: var(--primary-color); border-color: var(--primary-color); color: #fff; }
        button.primary:hover { background-color: var(--primary-color-hover); }
        button.danger { background: none; border: none; color: var(--text-secondary); padding: 5px 10px; font-size: 1em; }
        button.danger:hover { background-color: #d13438; color: #fff; }
        .delete-item-btn { background: none; border: none; color: var(--text-secondary); font-size: 24px; font-weight: 300; padding: 0 10px; line-height: 1; cursor: pointer; transition: opacity 0.2s; }
        .delete-item-btn:hover { color: #d13438; }
    </style>
</head>
<body>

    <div id="layout-container">
        <nav id="sidebar">
            <h2>My Lists</h2>
            <div id="new-list-form-container" class="form-group">
                <input type="text" id="new-list-input" placeholder="Create new list...">
                <button type="button" id="add-list-btn" class="primary">Add</button>
            </div>
            <ul id="sidebar-list"></ul>
        </nav>
        <main id="main-content"></main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addListBtn = document.getElementById('add-list-btn');
            const newListInput = document.getElementById('new-list-input');
            const sidebarList = document.getElementById('sidebar-list');
            const mainContent = document.getElementById('main-content');
            
            const LISTS_STORAGE_KEY = 'guahhLists_data_dark';
            const ACTIVE_LIST_STORAGE_KEY = 'guahhLists_activeId_dark';

            let lists = JSON.parse(localStorage.getItem(LISTS_STORAGE_KEY)) || [];
            let activeListId = JSON.parse(localStorage.getItem(ACTIVE_LIST_STORAGE_KEY)) || (lists.length > 0 ? lists[0].id : null);

            function saveLists() {
                localStorage.setItem(LISTS_STORAGE_KEY, JSON.stringify(lists));
            }

            function saveActiveListId() {
                localStorage.setItem(ACTIVE_LIST_STORAGE_KEY, JSON.stringify(activeListId));
            }

            function renderSidebar() {
                sidebarList.innerHTML = '';
                lists.forEach(list => {
                    const li = document.createElement('li');
                    li.textContent = escapeHTML(list.name);
                    li.dataset.listId = list.id;
                    if (list.id === activeListId) { li.classList.add('active'); }
                    sidebarList.appendChild(li);
                });
            }

            function renderMainContent() {
                const activeList = lists.find(list => list.id === activeListId);
                
                if (!activeList) {
                    mainContent.innerHTML = `<div class="placeholder-text"><p>Select a list from the sidebar or create a new one.</p></div>`;
                    return;
                }

                let itemsHTML = '<ul class="items-list">';
                activeList.items.forEach(item => {
                    const completedClass = item.completed ? 'completed' : '';
                    const checkedAttr = item.completed ? 'checked' : '';
                    itemsHTML += `
                        <li class="list-item ${completedClass}" data-item-id="${item.id}">
                            <input type="checkbox" class="toggle-item-btn" ${checkedAttr}>
                            <span>${escapeHTML(item.text)}</span>
                            <button class="delete-item-btn">Ã—</button>
                        </li>`;
                });
                itemsHTML += '</ul>';

                mainContent.innerHTML = `
                    <div class="list-header">
                        <h2>${escapeHTML(activeList.name)}</h2>
                        <button class="danger delete-list-btn">Delete This List</button>
                    </div>
                    ${itemsHTML}
                    <form class="form-group add-item-form">
                        <input type="text" class="new-item-input" placeholder="Add a to-do item...">
                        <button type="submit" class="primary">Add Item</button>
                    </form>`;
            }
            
            function createNewList() {
                const listName = newListInput.value.trim();
                if (listName) {
                    const newList = { id: Date.now(), name: listName, items: [] };
                    lists.push(newList);
                    activeListId = newList.id;
                    newListInput.value = '';
                    saveAndRenderAll();
                }
            }
            
            addListBtn.addEventListener('click', createNewList);
            newListInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); 
                    createNewList();
                }
            });

            sidebarList.addEventListener('click', (e) => {
                if (e.target.tagName === 'LI') {
                    activeListId = Number(e.target.dataset.listId);
                    saveAndRenderAll();
                }
            });
            
            mainContent.addEventListener('click', (e) => {
                // --- THIS IS THE CORRECTED AND VERIFIED DELETE LIST LOGIC ---
                if (e.target.classList.contains('delete-list-btn')) {
                    const activeList = lists.find(list => list.id === activeListId);
                    if (confirm(`Are you sure you want to permanently delete the "${activeList.name}" list?`)) {
                        const listIndex = lists.findIndex(l => l.id === activeListId);
                        
                        // 1. Remove the list from the main array in memory
                        lists = lists.filter(list => list.id !== activeListId);
                        
                        // 2. Intelligently select the next active list
                        if (lists.length > 0) {
                            // If there are lists remaining, select the one before the deleted one, or the first one if the first was deleted
                            const newIndex = Math.max(0, listIndex - 1);
                            activeListId = lists[newIndex].id;
                        } else {
                            // If no lists are left, set activeId to null
                            activeListId = null;
                        }
                        
                        // 3. Save changes to browser and re-render the entire UI
                        saveAndRenderAll();
                    }
                }
                
                if (e.target.classList.contains('delete-item-btn')) {
                    const itemId = Number(e.target.closest('.list-item').dataset.itemId);
                    const activeList = lists.find(list => list.id === activeListId);
                    if (activeList) {
                        activeList.items = activeList.items.filter(item => item.id !== itemId);
                        saveAndRenderAll();
                    }
                }
            });

            mainContent.addEventListener('submit', (e) => {
                e.preventDefault();
                if (e.target.classList.contains('add-item-form')) {
                    const input = e.target.querySelector('.new-item-input');
                    const itemText = input.value.trim();
                    const activeList = lists.find(list => list.id === activeListId);
                    if (itemText && activeList) {
                        activeList.items.push({ id: Date.now(), text: itemText, completed: false });
                        input.value = '';
                        saveAndRenderAll();
                    }
                }
            });

            mainContent.addEventListener('change', (e) => {
                if (e.target.classList.contains('toggle-item-btn')) {
                    const itemId = Number(e.target.closest('.list-item').dataset.itemId);
                    const activeList = lists.find(list => list.id === activeListId);
                    const targetItem = activeList?.items.find(item => item.id === itemId);
                    if (targetItem) {
                        targetItem.completed = e.target.checked;
                        saveAndRenderAll();
                    }
                }
            });

            function saveAndRenderAll() {
                saveLists();
                saveActiveListId();
                renderSidebar();
                renderMainContent();
            }
            
            function escapeHTML(str) {
                const p = document.createElement("p");
                p.textContent = str;
                return p.innerHTML;
            }

            saveAndRenderAll();
        });
    </script>

</body>
</html>